<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Taste of Choice</title>
<style>
:root {
  --comm-warm-bg: linear-gradient(135deg, rgba(255,107,53,0.55) 0%, rgba(255,142,83,0.50) 100%);
  --comm-distance-bg: linear-gradient(135deg, rgba(100,120,150,0.50) 0%, rgba(120,140,170,0.45) 100%);
  --comm-humor-bg: linear-gradient(135deg, rgba(255,195,0,0.55) 0%, rgba(255,215,70,0.50) 100%);
  --ingr-traditional-bg: linear-gradient(135deg, rgba(200,120,50,0.55) 0%, rgba(220,140,70,0.50) 100%);
  --ingr-spicy-bg: linear-gradient(135deg, rgba(180,20,20,0.60) 0%, rgba(210,50,50,0.55) 100%);
  --ingr-experimental-bg: linear-gradient(135deg, rgba(180,50,180,0.55) 0%, rgba(200,80,200,0.50) 100%);
  --pres-handmade-bg: linear-gradient(135deg, rgba(200,100,50,0.55) 0%, rgba(220,130,80,0.50) 100%);
  --pres-paper-bg: linear-gradient(135deg, rgba(40,50,70,0.60) 0%, rgba(60,70,90,0.55) 100%);
  --pres-garnish-bg: linear-gradient(135deg, rgba(255,80,120,0.55) 0%, rgba(255,120,160,0.50) 100%);
  --default-bg: linear-gradient(135deg, rgba(50,40,80,0.50) 0%, rgba(70,60,100,0.45) 100%);
  --bg: var(--default-bg);
  --text: #ffffff;
}

[data-tone="comm-warm"] { --bg: var(--comm-warm-bg); --text: #fff; }
[data-tone="comm-distance"] { --bg: var(--comm-distance-bg); --text: #fff; }
[data-tone="comm-humor"] { --bg: var(--comm-humor-bg); --text: #fff; }
[data-tone="ingr-traditional"] { --bg: var(--ingr-traditional-bg); --text: #fff; }
[data-tone="ingr-spicy"] { --bg: var(--ingr-spicy-bg); --text: #fff; }
[data-tone="ingr-experimental"] { --bg: var(--ingr-experimental-bg); --text: #fff; }
[data-tone="pres-handmade"] { --bg: var(--pres-handmade-bg); --text: #fff; }
[data-tone="pres-paper"] { --bg: var(--pres-paper-bg); --text: #fff; }
[data-tone="pres-garnish"] { --bg: var(--pres-garnish-bg); --text: #fff; }

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: system-ui, -apple-system, 'Segoe UI', 'Roboto', 'Ubuntu', 'Cantarell', sans-serif;
  color: var(--text);
  background-image: var(--bg), url('Background.png');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  transition: background-image 0.8s ease;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow-x: hidden;
}

@media (prefers-reduced-motion: reduce) {
  body, section, .choices button, #next-btn {
    transition-duration: 0.2s !important;
  }
}

section {
  display: none;
  opacity: 0;
  transition: opacity 0.6s ease;
  text-align: center;
  max-width: 800px;
  padding: 2rem;
}

section.active {
  display: block;
  opacity: 1;
}

h1 {
  font-size: 3rem;
  margin-bottom: 1rem;
  font-weight: 700;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
}

h2 {
  font-size: 1.5rem;
  margin-bottom: 2rem;
  font-weight: 400;
  text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
}

button {
  background: rgba(255,255,255,0.2);
  border: 2px solid rgba(255,255,255,0.6);
  color: #fff;
  font-size: 1.1rem;
  padding: 0.8rem 2rem;
  min-height: 44px;
  min-width: 44px;
  border-radius: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  margin: 0.5rem;
}

button:hover, button:focus {
  background: rgba(255,255,255,0.35);
  border-color: rgba(255,255,255,0.9);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  outline: none;
}

button:focus-visible {
  outline: 3px solid rgba(255,255,255,0.8);
  outline-offset: 2px;
}

button:active {
  transform: translateY(0);
}

.customer-label {
  font-size: 0.9rem;
  opacity: 0.8;
  margin-bottom: 1rem;
  letter-spacing: 1px;
}

.portrait {
  font-size: 4rem;
  margin: 1rem 0;
  filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.4));
}

.dialog {
  background: rgba(0,0,0,0.4);
  border-radius: 16px;
  padding: 1.5rem;
  margin: 2rem 0;
  min-height: 120px;
  font-size: 1.2rem;
  line-height: 1.6;
  text-align: left;
  cursor: pointer;
  backdrop-filter: blur(4px);
}

.choices {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1rem;
  margin: 2rem 0;
}

.choices button {
  flex: 1 1 200px;
  max-width: 250px;
}

.round-label {
  font-size: 0.85rem;
  opacity: 0.7;
  margin-top: 1rem;
}

#next-btn {
  display: none;
  margin-top: 1.5rem;
  font-size: 1.2rem;
  padding: 1rem 2.5rem;
}

#next-btn.show {
  display: inline-block;
}

.outcome-content {
  max-width: 700px;
  margin: 0 auto;
}

.outcome-content h2 {
  font-size: 2rem;
  margin-bottom: 1.5rem;
}

.outcome-content p {
  font-size: 1.3rem;
  margin: 1rem 0;
  line-height: 1.8;
}

.taco-icon {
  margin: 2rem 0;
  filter: drop-shadow(0 0 20px rgba(255,200,0,0.6));
}

.choices-summary {
  background: rgba(0,0,0,0.4);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  text-align: left;
  backdrop-filter: blur(4px);
}

.customer-summary {
  margin-bottom: 2rem;
}

.customer-summary h3 {
  font-size: 1.4rem;
  margin-bottom: 1rem;
  color: rgba(255,255,255,0.95);
}

.customer-summary ul {
  list-style: none;
  padding-left: 1rem;
}

.customer-summary li {
  margin: 0.5rem 0;
  font-size: 1rem;
  opacity: 0.9;
}

.customer-summary li strong {
  color: rgba(255,255,255,1);
}
</style>
</head>
<body data-tone="default">

<section id="intro">
  <h1>The Taste of Choice</h1>
  <h2>Every flavor tells a story.</h2>
  <button id="start-btn">Start Your Taco Stand</button>
</section>

<section id="customers">
  <div class="customer-label" id="customer-counter"></div>
  <div class="portrait" id="portrait"></div>
  <div class="dialog" id="dialog"></div>
  <div class="choices" id="choices"></div>
  <div class="round-label" id="round-label"></div>
  <button id="next-btn">Next</button>
</section>

<section id="outcome">
  <div class="outcome-content">
    <h2>You've served three different souls tonight.</h2>
    <p>Every choice changed a mood.</p>
    <p>Every flavor told a story.</p>
    <div class="taco-icon">
      <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="60" cy="70" rx="45" ry="25" fill="rgba(255,200,100,0.8)" stroke="rgba(200,150,50,0.9)" stroke-width="2"/>
        <ellipse cx="60" cy="50" rx="40" ry="20" fill="rgba(255,150,80,0.9)" stroke="rgba(200,100,50,0.9)" stroke-width="2"/>
        <ellipse cx="60" cy="45" rx="35" ry="15" fill="rgba(100,200,100,0.8)"/>
        <circle cx="50" cy="45" r="3" fill="rgba(255,0,0,0.7)"/>
        <circle cx="70" cy="47" r="3" fill="rgba(255,0,0,0.7)"/>
        <circle cx="60" cy="50" r="2" fill="rgba(255,255,0,0.8)"/>
      </svg>
    </div>
    <div class="choices-summary" id="summary"></div>
    <button id="restart-btn">Restart the Night</button>
  </div>
</section>

<audio id="ambient" loop>
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" type="audio/wav">
</audio>

<script>
const CUSTOMERS = [
  {
    id: 0,
    name: "Overworked Office Worker",
    emoji: "ðŸ§‘â€ðŸ’¼",
    intro: "A tired man in a suit walks up to your stand. He says: "It's been a long dayâ€¦ maybe food will help me breathe again."",
    reactions: {
      communication: {
        warm: "Thanksâ€¦ feels nice to be noticed after a long day.",
        respectful: "I appreciate the quiet. No small talk for once.",
        humor: "Haha, didn't expect to laugh tonight."
      },
      ingredients: {
        traditional: "This is comfort. Like home after overtime.",
        spicy: "Whoa! That actually woke me up.",
        experimental: "Pineapple? That'sâ€¦ surprisingly good."
      },
      presentation: {
        handmade: "You even plated it nicely. That's care.",
        paper: "Perfect. I'll eat this while heading back.",
        garnish: "Didn't expect street food to look this cheerful."
      }
    }
  },
  {
    id: 1,
    name: "Immigrant Woman",
    emoji: "ðŸ‘©â€ðŸ¦±",
    intro: "A woman carrying a small suitcase stops by. She says: "Your food smells familiarâ€¦ but the city feels so new."",
    reactions: {
      communication: {
        warm: "You make me feel like I belong here.",
        respectful: "Polite and kind â€” like a safe harbor.",
        humor: "Haha, maybe laughter sounds the same in every language."
      },
      ingredients: {
        traditional: "This tasteâ€¦ it brings back memories of home.",
        spicy: "Strong and fiery â€” like starting a new life.",
        experimental: "It's like two places meeting in one bite."
      },
      presentation: {
        handmade: "It feels personal â€” like something made for me.",
        paper: "I'll take it on my walk â€” my journey continues.",
        garnish: "So vibrantâ€¦ like the markets I miss."
      }
    }
  },
  {
    id: 2,
    name: "Art Student",
    emoji: "ðŸŽ¨",
    intro: "A quiet young artist with paint on her hands appears. She says: "I'm searching for inspirationâ€¦ maybe flavor can spark it."",
    reactions: {
      communication: {
        warm: "Your energy feelsâ€¦ like a sunrise after an all-nighter.",
        respectful: "I like how you give space. Inspiration needs silence.",
        humor: "Haha, you're playful â€” that's rare in serious artists."
      },
      ingredients: {
        traditional: "Simple. Honest. Like a clean canvas.",
        spicy: "Bold! That's passion in edible form.",
        experimental: "Fusionâ€¦ chaosâ€¦ I love it."
      },
      presentation: {
        handmade: "It's like edible art.",
        paper: "Casual, fleeting â€” like street sketches.",
        garnish: "Color! You understand aesthetics!"
      }
    }
  }
];

const ROUNDS = ['communication', 'ingredients', 'presentation'];

const ROUND_LABELS = {
  communication: 'Communication Style',
  ingredients: 'Ingredients',
  presentation: 'Presentation'
};

const CHOICES = {
  communication: [
    { key: 'warm', label: 'Warm welcome', tone: 'comm-warm' },
    { key: 'respectful', label: 'Respectful distance', tone: 'comm-distance' },
    { key: 'humor', label: 'Light humor', tone: 'comm-humor' }
  ],
  ingredients: [
    { key: 'traditional', label: 'Traditional taco (soft beef & onion)', tone: 'ingr-traditional' },
    { key: 'spicy', label: 'Spicy taco (extra chili)', tone: 'ingr-spicy' },
    { key: 'experimental', label: 'Experimental taco (fusion with pineapple)', tone: 'ingr-experimental' }
  ],
  presentation: [
    { key: 'handmade', label: 'Handmade plate', tone: 'pres-handmade' },
    { key: 'paper', label: 'Paper wrap', tone: 'pres-paper' },
    { key: 'garnish', label: 'Bright colored garnish', tone: 'pres-garnish' }
  ]
};

let state = {
  scene: 'intro',
  customerIndex: 0,
  roundIndex: 0,
  choicesLog: []
};

let typingInterval = null;
let isTyping = false;

const $intro = document.getElementById('intro');
const $customers = document.getElementById('customers');
const $outcome = document.getElementById('outcome');
const $startBtn = document.getElementById('start-btn');
const $nextBtn = document.getElementById('next-btn');
const $restartBtn = document.getElementById('restart-btn');
const $customerCounter = document.getElementById('customer-counter');
const $portrait = document.getElementById('portrait');
const $dialog = document.getElementById('dialog');
const $choices = document.getElementById('choices');
const $roundLabel = document.getElementById('round-label');
const $summary = document.getElementById('summary');
const $ambient = document.getElementById('ambient');

function showScene(scene) {
  [$intro, $customers, $outcome].forEach(el => el.classList.remove('active'));
  if (scene === 'intro') $intro.classList.add('active');
  else if (scene === 'customers') $customers.classList.add('active');
  else if (scene === 'outcome') $outcome.classList.add('active');
}

function typeText(element, text, callback) {
  isTyping = true;
  element.textContent = '';
  let i = 0;
  const speed = 30;

  function type() {
    if (i < text.length) {
      element.textContent += text.charAt(i);
      i++;
      typingInterval = setTimeout(type, speed);
    } else {
      isTyping = false;
      if (callback) callback();
    }
  }

  type();
}

function completeTyping(element, text) {
  if (typingInterval) clearTimeout(typingInterval);
  element.textContent = text;
  isTyping = false;
}

function playSelectSound() {
  try {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = 800;
    oscillator.type = 'sine';
    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
  } catch (e) {
    // Graceful degradation
  }
}

function renderCustomerScene() {
  const customer = CUSTOMERS[state.customerIndex];
  const round = ROUNDS[state.roundIndex];

  $customerCounter.textContent = `Customer ${state.customerIndex + 1}/3`;
  $portrait.textContent = customer.emoji;
  $roundLabel.textContent = `Round ${state.roundIndex + 1} of 3: ${ROUND_LABELS[round]}`;

  const isIntro = state.choicesLog.filter(c => c.customerId === customer.id).length === 0;
  const textToShow = isIntro ? customer.intro : '';

  if (textToShow) {
    typeText($dialog, textToShow);
  } else {
    $dialog.textContent = '';
  }

  $choices.innerHTML = '';
  CHOICES[round].forEach(choice => {
    const btn = document.createElement('button');
    btn.textContent = choice.label;
    btn.onclick = () => handleChoice(choice);
    $choices.appendChild(btn);
  });

  $nextBtn.classList.remove('show');
}

function handleChoice(choice) {
  const customer = CUSTOMERS[state.customerIndex];
  const round = ROUNDS[state.roundIndex];

  state.choicesLog.push({
    customerId: customer.id,
    customerName: customer.name,
    round: round,
    roundLabel: ROUND_LABELS[round],
    choiceKey: choice.key,
    choiceLabel: choice.label
  });

  document.body.setAttribute('data-tone', choice.tone);

  playSelectSound();

  const reaction = customer.reactions[round][choice.key];

  $choices.innerHTML = '';

  typeText($dialog, reaction, () => {
    setTimeout(() => {
      $nextBtn.classList.add('show');
    }, 600);
  });
}

function handleNext() {
  $nextBtn.classList.remove('show');

  if (state.roundIndex < 2) {
    state.roundIndex++;
    renderCustomerScene();
  } else if (state.customerIndex < 2) {
    state.customerIndex++;
    state.roundIndex = 0;
    renderCustomerScene();
  } else {
    state.scene = 'outcome';
    renderOutcome();
    showScene('outcome');
  }
}

function renderOutcome() {
  $summary.innerHTML = '';

  for (let i = 0; i < 3; i++) {
    const customer = CUSTOMERS[i];
    const customerChoices = state.choicesLog.filter(c => c.customerId === i);

    const div = document.createElement('div');
    div.className = 'customer-summary';

    const h3 = document.createElement('h3');
    h3.textContent = `${customer.emoji} ${customer.name}`;
    div.appendChild(h3);

    const ul = document.createElement('ul');
    customerChoices.forEach(c => {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${c.roundLabel}:</strong> ${c.choiceLabel}`;
      ul.appendChild(li);
    });
    div.appendChild(ul);

    $summary.appendChild(div);
  }
}

function restart() {
  state = {
    scene: 'intro',
    customerIndex: 0,
    roundIndex: 0,
    choicesLog: []
  };
  document.body.setAttribute('data-tone', 'default');
  showScene('intro');
}

$startBtn.addEventListener('click', () => {
  try {
    $ambient.play().catch(() => {});
  } catch (e) {}

  state.scene = 'customers';
  state.customerIndex = 0;
  state.roundIndex = 0;
  state.choicesLog = [];

  showScene('customers');
  renderCustomerScene();
});

$nextBtn.addEventListener('click', handleNext);

$restartBtn.addEventListener('click', restart);

$dialog.addEventListener('click', () => {
  if (isTyping) {
    const customer = CUSTOMERS[state.customerIndex];
    const round = ROUNDS[state.roundIndex];
    const lastChoice = state.choicesLog[state.choicesLog.length - 1];
    if (lastChoice && lastChoice.customerId === customer.id && lastChoice.round === round) {
      const reaction = customer.reactions[round][lastChoice.choiceKey];
      completeTyping($dialog, reaction);
      setTimeout(() => {
        $nextBtn.classList.add('show');
      }, 100);
    }
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    if (document.activeElement.tagName === 'BUTTON') {
      e.preventDefault();
      document.activeElement.click();
    }
  }
});

showScene('intro');
</script>

</body>
</html>
